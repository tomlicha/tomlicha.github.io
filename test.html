<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/dygraph/2.0.0/dygraph.min.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
<title>Tom Licha</title>
<body> 
                <div class="container-fluid">

                                <header class="row">
                          
                             
                          
                          <nav class="navbar navbar-default navbar-fixed-top ">
                          
                          
                          
                              <!-- Brand and toggle get grouped for better mobile display -->
                              <div class="navbar-header">
   
                                </a>
                              
                              </div>
                          
                              <i class="fa fa-bars  toggle-btn navbar-toggle" id="toggle-top" data-toggle="collapse" data-target="#top-menu-content,#nav_bar_top-right" aria-expanded="flase"></i>
                          
                              <!-- Collect the nav links, forms, and other content for toggling -->
                              <div class="menu-list" id="nav_bar_top">
                          
                                <ul id="top-menu-content" class="menu-content nav navbar-nav in">
                            
                                </ul>

                          
                              </div><!-- /.navbar-collapse -->
                            </nav></header></div>

        <button type="submit" onclick="UserAction()">Search</button>
<script>
var csv
        function UserAction(){
$.ajax({
        url: 'https://84.7.38.34:443/collections/aze',
         success: function(data){
            //process the JSON data etc
            console.log(data[1]["date"]);
            alert((data[1]["date"]));
            csv = ConvertToCSV(data,["date","temperature","humidité","id\n"])
            console.log(csv);
            
        afficherGraphe(csv, options,"graph");
        }
})
}

function ConvertToCSV(objArray,headers) {
        var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
        var str = '';
        
        str+=headers;
        for (var i = 0; i < array.length; i++) {
            var line = '';
            for (var index in array[i]) {
                if (line != '') line += ','
                        line += array[i][index];
              
            }

            str += line + '\r\n';
        }

        return str;

    }

var afficherGraphe = function(csvfile, options, id_graphe) {

g = new Dygraph(

   // containing div
   document.getElementById(id_graphe),

   // CSV or path to a CSV file.
   csvfile,

   //Options
   options
 );
};

var options =     {  
          animatedZooms :true,
          title : 'Température et Humidité ambiante',
          titleHeight : 30,
          labelsGMT: true, 
          ylabel : "valeur mesurée (°C et %)",
          y2label:"seuils d'alerte",
          labelsSeparateLines :true,
          xlabel : "date de la mesure",
          legend:'follow',
          fillGraph: true,
          fillAlpha: 0.5,
          labelsDivStyles: {'textAlign': 'right'},
          colors : ['#86BBEE','#5FBA7D','#FF0000','#FF0000'],
           "series": {

              "alerte humidité": {
                "fillAlpha":0
              },
              "alerte température": {
                "fillAlpha":0
              },
              "Humidité %": {
               "connectSeparatedPoints":true
              },
              "Température °C": {
               "connectSeparatedPoints":true
              },
            },
            
                       
     };



</script>
<div class="container-fluid">
        <div id="graph" style="height:320px; margin-top: 10px;"></div>
      </div>

</body>

</HTML>
